{{ $outdir := or .Vars.outputdir "." -}}
templates:
  kustomization:
    path: kustomization.yaml
    output: {{ $outdir }}/kustomization.yaml
  namespace:
    path: namespace.yaml
    output: {{ $outdir }}/namespace.yaml

components:
  postgres:
    kind: local
    path: postgres/component.yaml
    vars:
      kube:
        outputdir: {{ .Vars.outputdir }}/postgres
        namespace: {{ .Vars.namespace }}
        label:
          partof: {{ .Vars.service.name }}
        service:
          image:
            name: {{ .Vars.images.postgres.name }}
            version: {{ .Vars.images.postgres.version }}
          storage:
            amount: {{ .Vars.storage.postgres }}
          init:
            image:
              name: {{ .Vars.images.xorkevinalpine.name }}
              version: {{ .Vars.images.xorkevinalpine.version }}

        register:
          image:
            name: {{ .Vars.images.xorkevinalpine.name }}
            version: {{ .Vars.images.xorkevinalpine.version }}

      vault:
        addr: {{ .Vars.vault.addr }}
        kubemount: {{ .Vars.vault.kubemount }}
        kvmount: {{ .Vars.vault.kvmount }}
        kvprefix: {{ .Vars.vault.kvprefix }}
        dbmount: {{ .Vars.vault.dbmount }}

      registerdir: {{ .Vars.registerdir }}
      policydir: {{ .Vars.policydir }}
      rolesdir: {{ .Vars.rolesdir }}

  redis:
    kind: local
    path: redis/component.yaml
    vars:
      kube:
        outputdir: {{ .Vars.outputdir }}/redis
        namespace: {{ .Vars.namespace }}
        label:
          partof: {{ .Vars.service.name }}
        service:
          image:
            name: {{ .Vars.images.redis.name }}
            version: {{ .Vars.images.redis.version }}
          init:
            image:
              name: {{ .Vars.images.xorkevinalpine.name }}
              version: {{ .Vars.images.xorkevinalpine.version }}

        register:
          image:
            name: {{ .Vars.images.xorkevinalpine.name }}
            version: {{ .Vars.images.xorkevinalpine.version }}

      vault:
        addr: {{ .Vars.vault.addr }}
        kubemount: {{ .Vars.vault.kubemount }}
        kvmount: {{ .Vars.vault.kvmount }}
        kvprefix: {{ .Vars.vault.kvprefix }}

      registerdir: {{ .Vars.registerdir }}
      policydir: {{ .Vars.policydir }}
      rolesdir: {{ .Vars.rolesdir }}

  minio:
    kind: local
    path: minio/component.yaml
    vars:
      kube:
        outputdir: {{ .Vars.outputdir }}/minio
        namespace: {{ .Vars.namespace }}
        label:
          partof: {{ .Vars.service.name }}
        service:
          image:
            name: {{ .Vars.images.minio.name }}
            version: {{ .Vars.images.minio.version }}
          init:
            image:
              name: {{ .Vars.images.xorkevinalpine.name }}
              version: {{ .Vars.images.xorkevinalpine.version }}

        register:
          image:
            name: {{ .Vars.images.xorkevinalpine.name }}
            version: {{ .Vars.images.xorkevinalpine.version }}

      vault:
        addr: {{ .Vars.vault.addr }}
        kubemount: {{ .Vars.vault.kubemount }}
        kvmount: {{ .Vars.vault.kvmount }}
        kvprefix: {{ .Vars.vault.kvprefix }}

      registerdir: {{ .Vars.registerdir }}
      policydir: {{ .Vars.policydir }}
      rolesdir: {{ .Vars.rolesdir }}
